<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>鍼灸ツボ辞典｜教科書準拠版（症状→経穴・人体表示）</title>
  <meta name="description" content="『臨床経穴ポケットガイド361穴』の構成に合わせて、症状から推奨経穴を逆引きし、人体シルエット上に位置を可視化する学習用Index.html。">
  <link rel="preconnect" href="https://cdn.tailwindcss.com">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body { height: 100%; }
    .btn { border:1px solid rgb(226 232 240); border-radius:0.75rem; padding:0.5rem 0.75rem; font-size:0.875rem; }
    .btn:hover { background:#f8fafc }
    .chip { border:1px solid rgb(226 232 240); border-radius:9999px; padding:0.125rem 0.5rem; font-size:0.75rem; }
    .dot { r:6; filter: drop-shadow(0 0 4px rgba(0,0,0,.25)); cursor:pointer; }
    .dot.active { r:8; }
    .shadow-soft { box-shadow: 0 2px 8px rgba(0,0,0,0.06) }
    .kbd { border:1px solid rgb(226 232 240); border-radius:0.375rem; padding:0 0.375rem; font-size:0.675rem; }
    @media (prefers-color-scheme: dark) {
      body { background: #0b1220; color: #e5e7eb; }
      .btn { border-color: #1f2937; }
      .chip { border-color: #1f2937; }
      .bg-white { background: #0f172a !important; }
      .text-slate-500 { color: #94a3b8 !important; }
      .text-slate-600 { color: #cbd5e1 !important; }
      .border { border-color: #1f2937 !important; }
      .bg-slate-50 { background: #0b1220 !important; }
      .bg-slate-100 { background: #111827 !important; }
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-white to-slate-50">
  <div class="mx-auto max-w-6xl p-4 md:p-8">
    <header class="mb-6 flex items-center justify-between gap-3">
      <div>
        <h1 class="text-2xl md:text-3xl font-semibold tracking-tight">鍼灸ツボ辞典｜教科書準拠版</h1>
        <p class="text-sm text-slate-600">症状を選ぶ → 推奨ツボ一覧 → 人体シルエットで位置を可視化。『臨床経穴ポケットガイド361穴』の見出し構造（経脈→経穴→部位/穴性）に沿って表示。※刺鍼方法は表示せず、押圧にも使えるよう「深さ（目安）」のみ記載します。</p>
      </div>
      <div class="flex items-center gap-2">
        <button id="toggleTextbook" class="btn" aria-pressed="true">教科書準拠モード: <span id="modeLabel">ON</span></button>
        <a href="#" id="toQuiz" class="btn">クイズ版へ</a>
      </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- LEFT: Controls & List -->
      <section class="bg-white border rounded-2xl shadow-soft p-4 space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
          <div>
            <label class="text-sm text-slate-600">症状を選択</label>
            <select id="symptom" class="w-full border rounded-xl px-3 py-2 mt-1 text-sm"></select>
          </div>
          <div>
            <label class="text-sm text-slate-600">表示面</label>
            <select id="viewSide" class="w-full border rounded-xl px-3 py-2 mt-1 text-sm">
              <option value="front">前面</option>
              <option value="back">後面</option>
            </select>
          </div>
          <div>
            <label class="text-sm text-slate-600">経脈</label>
            <select id="meridianFilter" class="w-full border rounded-xl px-3 py-2 mt-1 text-sm">
              <option value="">すべて</option>
            </select>
          </div>
          <div>
            <label class="text-sm text-slate-600">検索</label>
            <input id="search" type="text" placeholder="名称 / 英名 / 取穴 / 適応" class="w-full border rounded-xl px-3 py-2 mt-1 text-sm">
          </div>
        </div>

        <div id="list" class="grid grid-cols-1 md:grid-cols-2 gap-3"></div>
      </section>

      <!-- RIGHT: Human Body Map -->
      <section class="bg-white border rounded-2xl shadow-soft p-4">
        <div class="flex items-center justify-between">
          <div class="text-lg font-semibold">人体シルエット</div>
          <div class="text-xs text-slate-500">点をクリックでカードをハイライト（<span class="kbd">Esc</span>で解除）</div>
        </div>
        <div class="mt-2 relative">
          <svg id="figure" viewBox="0 0 100 200" class="w-full h-[560px] bg-slate-50 rounded-xl border">
            <!-- Simple silhouette (front/back share same base) -->
            <g id="silhouette" fill="none" stroke="currentColor" stroke-width="0.5" opacity="0.5">
              <!-- head -->
              <circle cx="50" cy="18" r="10"/>
              <!-- torso -->
              <path d="M35 28 Q50 34 65 28 L65 90 Q50 96 35 90 Z"/>
              <!-- arms (simplified) -->
              <path d="M35 32 L20 70"/>
              <path d="M65 32 L80 70"/>
              <!-- legs -->
              <path d="M45 90 L40 150 L45 198"/>
              <path d="M55 90 L60 150 L55 198"/>
            </g>
            <g id="dots"></g>
          </svg>
        </div>
      </section>
    </div>

    <section class="mt-6 text-xs text-slate-400">
      参考注意: 本ページは教育・学習用の簡略表示です。刺鍼手技の詳細は提供せず、押圧にも使えるよう深さ目安のみを掲載しています。医療行為・診断は各国家資格の範囲で実施し、禁忌や既往がある場合は専門家にご相談ください。
    </section>
  </div>

<script>
// --- Data (教科書準拠の見出し: 経脈 -> 経穴 -> 部位/穴性/深さ/備考/出典p) ---
// 収載は抜粋（症状ユースケース中心）。文言は要約し簡略化（直引用ではありません）。
const POINTS = [
  {id:"GV20", nameJP:"百会", nameEN:"Baihui", meridian:"督脈", region:"頭頂部",
   location:"両耳尖を結ぶ線の正中上、頭頂の陥凹（前髪際と後髪際を9等分し上から5/9）",
   indications:["頭痛","めまい","意識障害","脱肛・痔","気分安定"],
   depth:"0.3–0.5寸（浅）",
   notes:"陽経交会所。昇陽挙陥・安神。",
   src:"GV p.29–30"},
  {id:"TE5", nameJP:"外関", nameEN:"Waiguan", meridian:"手少陽三焦経", region:"前腕背側",
   location:"手関節背横紋の上2寸、橈尺骨間の溝中。",
   indications:["頭痛・こめかみ","耳鳴り","悪寒発熱","頸肩こり"],
   depth:"0.5–1.0寸",
   notes:"絡穴・八脈交会穴（陽維脈）。",
   src:"TE p.212–214"},
  {id:"GB20", nameJP:"風池", nameEN:"Fengchi", meridian:"足少陽胆経", region:"後頸部",
   location:"乳様突起と僧帽筋外縁の間の陥凹、後頭骨下縁。",
   indications:["片頭痛","頸肩こり","めまい","眼精疲労","感冒初期"],
   depth:"0.5–1.0寸（斜刺方向注意）",
   notes:"頭頸部の要穴。",
   src:"GB p.224–225"},
  {id:"LI4", nameJP:"合谷", nameEN:"Hegu", meridian:"手陽明大腸経", region:"手背",
   location:"第1・2中手骨の間、中手骨底の遠位で第2中手骨橈側。",
   indications:["頭痛","顔面痛","歯痛","感冒初期","鎮痛・鎮静"],
   depth:"0.5–1.0寸（妊婦注意）",
   notes:"四総穴の一。鎮痛要穴。",
   src:"LI p.62–63"},
  {id:"LR3", nameJP:"太衝", nameEN:"Taichong", meridian:"足厥陰肝経", region:"足背",
   location:"第1・2中足骨間後方の陥凹。",
   indications:["情緒不安","頭痛","月経痛","上熱下寒の調整"],
   depth:"0.3–0.8寸",
   notes:"肝気鬱結の代表穴。",
   src:"LR p.240–241"},
  {id:"LI11", nameJP:"曲池", nameEN:"Quchi", meridian:"手陽明大腸経", region:"肘部",
   location:"肘窩横紋外端、上腕骨外上顆前縁。",
   indications:["清熱","皮膚炎・蕁麻疹","肘痛"],
   depth:"0.5–1.5寸",
   notes:"清熱・皮膚の要穴。",
   src:"LI p.67"},
  {id:"PC6", nameJP:"内関", nameEN:"Neiguan", meridian:"手厥陰心包経", region:"前腕掌側",
   location:"手関節掌側横紋の上2寸、橈側手根屈筋腱と長掌筋腱の間。",
   indications:["悪心・嘔吐","動悸","胸悶","自律神経調整"],
   depth:"0.5–1.0寸",
   notes:"乗り物酔い有名。",
   src:"PC p.203–204"},
  {id:"SP10", nameJP:"血海", nameEN:"Xuehai", meridian:"足太陰脾経", region:"大腿内側",
   location:"膝蓋骨内上縁の上2寸、内側広筋の隆起部。",
   indications:["皮膚瘙痒","湿疹","月経不順"],
   depth:"0.8–1.2寸",
   notes:"血の海。",
   src:"SP p.112–113"},
  {id:"GV16", nameJP:"風府", nameEN:"Fengfu", meridian:"督脈", region:"後頭部",
   location:"後髪際の中央、うなじの陥凹。",
   indications:["後頭部痛","めまい","精神緊張"],
   depth:"0.3–0.5寸（浅）",
   notes:"頭項の要穴。",
   src:"GV p.27"}
];

// 症状セット（顔の赤み・片頭痛など）
const SYMPTOMS = [
  {label:"片頭痛・頭痛", ids:["GB20","TE5","LI4","GV20","LR3","GV16"]},
  {label:"顔の赤み・潮紅", ids:["GV20","LI11","LI4","LR3","PC6","SP10"]},
  {label:"肩こり・首こり", ids:["GB20","TE5","LI4"]},
  {label:"悪心・嘔吐", ids:["PC6","ST36"]}
];

// 人体座標（簡略）
const COORDS = {
  front: {
    GV20:[50,2], GB20:[45,8], GV16:[50,9],
    LI4:[30,60], TE5:[33,55], PC6:[35,58], LI11:[32,50],
    SP10:[45,70], LR3:[48,98]
  },
  back: { GB20:[55,8], GV16:[50,9] }
};

// --- Build index ---
const byId = Object.fromEntries(POINTS.map(p=>[p.id,p]));

// Fill selects
const sel = document.getElementById('symptom');
SYMPTOMS.forEach((s,i)=>{ const o=document.createElement('option'); o.value=i; o.textContent=s.label; sel.appendChild(o); });
sel.value = "0";

const meridianSel = document.getElementById('meridianFilter');
[...new Set(POINTS.map(p=>p.meridian))].sort().forEach(m=>{ const o=document.createElement('option'); o.value=m; o.textContent=m; meridianSel.appendChild(o); });

const sideSel = document.getElementById('viewSide');
const searchInput = document.getElementById('search');
const list = document.getElementById('list');
const dotsLayer = document.getElementById('dots');
let textbookMode = true;

function cardHTML(p){
  return `
    <div class="text-sm font-semibold flex items-center justify-between">
      <span>${p.nameJP} <span class="text-slate-500 text-xs">(${p.id})</span></span>
      <span class="chip">${p.meridian}</span>
    </div>
    <div class="text-xs text-slate-500">${p.nameEN} / ${p.region}</div>
    <div><span class="text-xs text-slate-500">部位（取穴法）</span><div class="text-sm">${p.location}</div></div>
    <div><span class="text-xs text-slate-500">穴性・適応</span><div class="text-sm flex flex-wrap gap-1">${p.indications.map(i=>`<span class=\"chip\">${i}</span>`).join(' ')}</div></div>
    <div class="grid grid-cols-2 gap-2">
      <div><span class="text-xs text-slate-500">深さ（目安）</span><div class="text-sm">${p.depth||'—'}</div></div>
      <div><span class="text-xs text-slate-500">備考</span><div class="text-sm">${p.notes||'—'}</div></div>
    </div>
    <div class="text-xs text-slate-500">出典: ${p.src||'—'}</div>
  `;
}

function render(){
  const side = sideSel.value;
  const ids = currentIds();
  list.innerHTML = '';
  ids.forEach(id=>{
    const p = byId[id];
    const card = document.createElement('div');
    card.className = 'border rounded-xl p-3 hover:bg-slate-50';
    card.dataset.id = id;
    card.innerHTML = cardHTML(p);
    card.addEventListener('mouseenter',()=> highlightDot(id,true));
    card.addEventListener('mouseleave',()=> highlightDot(id,false));
    list.appendChild(card);
  });

  // dots
  dotsLayer.innerHTML = '';
  ids.forEach(id=>{
    const c = COORDS[side][id];
    if(!c) return;
    const [x,y] = c;
    const dot = document.createElementNS('http://www.w3.org/2000/svg','circle');
    dot.setAttribute('cx',x);
    dot.setAttribute('cy',y);
    dot.setAttribute('class','dot');
    dot.setAttribute('fill','currentColor');
    dot.addEventListener('mouseenter',()=> highlightCard(id,true));
    dot.addEventListener('mouseleave',()=> highlightCard(id,false));
    dot.addEventListener('click',()=> scrollToCard(id));
    dotsLayer.appendChild(dot);
  });
}

function currentIds(){
  const s = SYMPTOMS[parseInt(sel.value,10)];
  const q = searchInput.value.trim().toLowerCase();
  const mf = meridianSel.value;
  let ids = s.ids.slice();
  if (mf) ids = ids.filter(id => byId[id]?.meridian === mf);
  if (q){
    ids = ids.filter(id => {
      const p = byId[id];
      return p.id.toLowerCase().includes(q) ||
             p.nameJP.includes(q) ||
             p.nameEN.toLowerCase().includes(q) ||
             p.location.includes(q) ||
             p.indications.some(i=>i.includes(q));
    });
  }
  return ids;
}

function highlightDot(id,on){
  const dots = dotsLayer.querySelectorAll('circle');
  dots.forEach(d=>{
    const match = Math.abs(d.getAttribute('cx')-COORDS[sideSel.value][id]?.[0])<0.1 && Math.abs(d.getAttribute('cy')-COORDS[sideSel.value][id]?.[1])<0.1;
    if(match){ d.classList.toggle('active',on); }
  });
}
function highlightCard(id,on){
  const el = [...list.children].find(e=>e.dataset.id===id);
  if(el){ el.classList.toggle('bg-slate-50',on); }
}
function scrollToCard(id){
  const el = [...list.children].find(e=>e.dataset.id===id);
  if(el){ el.scrollIntoView({behavior:'smooth',block:'center'}); el.classList.add('bg-slate-100'); setTimeout(()=>el.classList.remove('bg-slate-100'),800); }
}

// events
[sel, meridianSel, sideSel].forEach(e=> e.addEventListener('change', render));
searchInput.addEventListener('input', render);

// Esc to clear highlights
window.addEventListener('keydown', (ev)=>{ if(ev.key==='Escape'){ highlightDot(SYMPTOMS[sel.value].ids[0], false); [...list.children].forEach(c=>c.classList.remove('bg-slate-50','bg-slate-100')); }});

render();
</script>
</body>
</html>
