<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ツボマップ（症状別フィルタ）</title>
<style>
  body{margin:0;background:#fafafa;color:#222;font-family:"Noto Sans JP","Yu Gothic",sans-serif}
  header{background:#444;color:#fff;padding:1rem;font-weight:600}
  .wrap{max-width:1200px;margin:1.5rem auto;padding:0 1rem;display:grid;grid-template-columns:300px 1fr;gap:16px}
  @media(max-width:960px){.wrap{grid-template-columns:1fr}}
  .panel{background:#fff;border:1px solid #ddd;border-radius:12px;padding:1rem;box-shadow:0 1px 4px rgba(0,0,0,.05)}
  select,button{font-size:1rem;padding:.6rem .8rem;border-radius:10px;border:1px solid #aaa}
  button{background:#0f766e;color:#fff;border-color:#0f766e;cursor:pointer}
  button.ghost{background:#fff;color:#0f766e}
  object{width:100%;height:auto;border:1px solid #ddd;border-radius:10px}
</style>
</head>
<body>
<header>ツボマップ（GitHub Pages｜症状別フィルタ）</header>
<div class="wrap">
  <aside class="panel">
    <h3>症状から選ぶ</h3>
    <select id="symSelect">
      <option value="">— 症状を選択 —</option>
      <option value="肩こり">肩こり</option>
      <option value="頭痛">頭痛</option>
      <option value="顎関節痛">顎関節痛</option>
      <option value="鼻閉・花粉症">鼻閉・花粉症</option>
      <option value="逆流性食道炎">逆流性食道炎</option>
      <option value="PMS">PMS</option>
      <option value="坐骨神経痛">坐骨神経痛</option>
      <option value="足関節痛">足関節痛</option>
    </select>
    <div style="margin-top:10px;display:flex;gap:8px;">
      <button id="apply">表示</button>
      <button class="ghost" id="clear">解除</button>
    </div>
  </aside>
  <main class="panel">
    <object id="svgObj" type="image/svg+xml" data="tsubo_map_front_medical_web.svg"></object>
  </main>
</div>

<script>
const symptomMap = {
  "肩こり": ["肩井","風池","天柱","肩髃","曲池","合谷"],
  "頭痛": ["百会","印堂","風池","太衝","合谷"],
  "顎関節痛": ["頰車","下関","合谷","太渓"],
  "鼻閉・花粉症": ["迎香","印堂","百会","合谷","上星"],
  "逆流性食道炎": ["内関","中脘","膻中","足三里"],
  "PMS": ["三陰交","太衝","関元","気海"],
  "坐骨神経痛": ["環跳","殷門","委中","承山","承扶","陽陵泉"],
  "足関節痛": ["解谿","崑崙","太谿","丘墟","申脈"]
};

const svgObj = document.getElementById('svgObj');
let svgDoc, nameToElements = new Map();

svgObj.addEventListener('load', () => {
  svgDoc = svgObj.contentDocument;
  const circles = Array.from(svgDoc.querySelectorAll('circle'));
  const texts = Array.from(svgDoc.querySelectorAll('text'));
  texts.forEach(t => {
    const name = t.textContent.trim();
    if(!name) return;
    const tb = t.getBBox(), tx = tb.x + tb.width/2, ty = tb.y + tb.height/2;
    let best=null,bestD=1e9;
    circles.forEach(c=>{
      const cx=parseFloat(c.getAttribute('cx')||0), cy=parseFloat(c.getAttribute('cy')||0);
      const d=(cx-tx)**2+(cy-ty)**2;
      if(d<bestD){bestD=d;best=c;}
    });
    if(best){
      if(!nameToElements.has(name)) nameToElements.set(name,{text:t,dot:best});
    }
  });
});

function applySymptom(){
  const val=document.getElementById('symSelect').value;
  if(!svgDoc||!val)return;
  const showList=symptomMap[val]||[];
  nameToElements.forEach((pair,name)=>{
    const visible=showList.includes(name);
    pair.text.style.display=visible?"":"none";
    pair.dot.style.display=visible?"":"none";
  });
}

function clearAll(){
  if(!svgDoc)return;
  nameToElements.forEach(pair=>{
    pair.text.style.display="";
    pair.dot.style.display="";
  });
  document.getElementById('symSelect').value="";
}

document.getElementById('apply').onclick=applySymptom;
document.getElementById('clear').onclick=clearAll;
</script>
</body>
</html>
